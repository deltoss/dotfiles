{{ if eq .chezmoi.os "windows" -}}

Write-Host "Configuring necessary environment variables..."
$env:CHEZMOI_SOURCEDIR = "{{.chezmoi.sourceDir}}"

# Installs prerequisites for the Install Scripts
winget install --id "Valve.Steam" -e --no-upgrade
& "$env:CHEZMOI_SOURCEDIR/scripts/install-steamcmd.ps1"

{{- $steamAppsToInstall := list -}}
{{- if hasKey .steamApps.windows "core" -}}
  {{- $steamAppsToInstall = concat $steamAppsToInstall .steamApps.windows.core -}}
{{- end -}}
{{- if and (eq .computerPurpose "personal") (hasKey .steamApps.windows "personal") -}}
  {{- $steamAppsToInstall = concat $steamAppsToInstall .steamApps.windows.personal -}}
{{- else if and (eq .computerPurpose "work") (hasKey .steamApps.windows "work") -}}
  {{- $steamAppsToInstall = concat $steamAppsToInstall .steamApps.windows.work -}}
{{- end -}}

{{- range $steamAppsToInstall }}
  Write-Host "Installing app id of {{ .id }} ({{.name}})..."
{{- end }}

$steamUsername = "{{ .steamUsername }}"
$baseInstallPath = "C:\Program Files (x86)\Steam\steamapps\common"
{{ range $steamAppsToInstall }}
# steamcmd +force_install_dir "$baseInstallPath\{{ .folderName }}" +login $steamUsername +app_update {{ .id }} +quit
{{ end }}

Write-Host "Steam app installs complete..." -ForegroundColor Green

{{- end -}}
